import{s,g as i,I as a}from"../vant/vant.52bb3d0f.js";import{M as t}from"../index/index.ebf7d32e.js";import{F as n}from"../index/index.5377438e.js";import{g as o}from"../vue3-video-play/vue3-video-play.531530fd.js";import{d as e}from"../pinia/pinia.86e899a9.js";import{m as l,i as r,v as c,j as m,a as u,s as g,b as d}from"../index/index.1b674fdb.js";import{a as v,ab as f,w as p,P as y,Q as _,W as h,G as w,X as T,u as D,H as L,Z as x,L as P,a0 as j,a2 as b,U as M,V as C}from"../@vue/@vue.94aa2a2d.js";import{b as S}from"../vue-router/vue-router.b68e67a8.js";import{c as U}from"../useFilter/useFilter.6545905c.js";import{_ as I}from"../../assets/index-04b0ac89.js";import"../@vant/@vant.4990c6ed.js";import"../axios/axios.c5318529.js";import"../form-data/form-data.01cb563f.js";import"../china-division/china-division.19bf229b.js";import"../nprogress/nprogress.6d8e6ba3.js";import"../pinia-plugin-persistedstate/pinia-plugin-persistedstate.712c107f.js";const R=e("mvListDetail",(()=>{const s=v({mv:{id:0,name:"",artistId:0,artistName:"",artists:[],brs:[{br:240}],cover:"",desc:"",duration:0,publishTime:0,commentCount:0,playCount:0,shareCount:0,subCount:0},mvUrl:"",simiMvs:[]});return{mvListDetail:s,getSimiMv:async function(i){const a=await m(i);s.simiMvs=a.mvs,console.log("相似mv",a)},getVideoDetail:async function(s){const i=await c(s);console.log("视频详情",i)},getMvDetail:async function(i){const a=await l(i);s.mv=a.data,console.log("mv详情",a.data)},getMvUrl:async function(i,a){const t=await r(i,a);s.mvUrl=t.data.url,console.log("mv播放地址",t.data)}}})),k=e("Audio",(()=>{const a=new Audio,t=v({url:"",level:"standard",song:{},songs:[],volume:.5,duration:0,isPlay:!1,playMode:"order",lyric:"",haveRomalrc:!1,haveTlyric:!1,isTrial:!1});async function n(s){const i=await g(s,t.level);t.url=i.data[0].url,await m(t.song.id)}async function o(s){const i=await d(s);t.song=i.songs[0]}function e(){t.songs.some((s=>s.id===t.song.id))?console.log("❌重复添加",t.songs):(t.songs.push(t.song),console.log("✅添加成功",t.songs))}function l(){t.songs=[],t.song={},t.url="",t.lyric="",a.pause(),console.log("🧺清空成功",t.songs)}async function r(){if(t.songs.length>0){const s=t.songs.findIndex((s=>s.id===t.song.id));s===t.songs.length-1?(t.song=t.songs[0],await n(t.song.id),c(t.isPlay),a.currentTime=0):(t.song=t.songs[s+1],await n(t.song.id),c(t.isPlay),a.currentTime=0),console.log("⏭播放下一首")}}async function c(o){t.isPlay=o,t.isPlay?(a.src&&a.src===t.url?a.play().then((()=>{a.duration<31?(t.isTrial=!t.isTrial,setTimeout((()=>{t.isTrial=!0}),0)):(t.isTrial=!t.isTrial,setTimeout((()=>{t.isTrial=!1}),0)),console.log("🎵audio.src存在，继续播放")})).catch((async s=>{console.log("❗歌曲链接过期",s),await n(t.song.id),a.src=t.url,a.play().then((()=>{console.log("🎵audio.src不存在，重新获取歌曲链接并播放")})).catch((s=>{console.log("❗播放失败",s),t.isPlay=!1,a.pause()}))})):t.url?(a.src=t.url,a.play().then((()=>{a.duration<31?(t.isTrial=!t.isTrial,setTimeout((()=>{t.isTrial=!0}),0)):(t.isTrial=!t.isTrial,setTimeout((()=>{t.isTrial=!1}),0))})).catch((s=>{console.log("🎵url获取成功，但是播放失败",s),t.isPlay=!1,a.pause()}))):4===t.song.fee?(t.isPlay=!1,a.pause(),s({type:"primary",message:"数字专辑歌曲请先购买后再播放"})):0===t.song.fee?(t.isPlay=!1,a.pause(),s({type:"warning",message:"暂无播放版权"})):(t.isPlay=!1,a.pause(),console.log("🎵url获取失败，播放失败"),i("VIP歌曲")),a.onended=()=>{r(),console.log("播放结束,自动播放下一首")},t.lyric||m(t.song.id),console.log("🎤播放")):(a.pause(),console.log("⏸暂停"))}async function m(s){var i,a;const n=await u(s);n.romalrc&&n.romalrc.lyric?t.haveRomalrc=!0:t.haveRomalrc=!1,n.tlyric&&n.tlyric.lyric?t.haveTlyric=!0:t.haveTlyric=!1,t.lyric=function(s,i,a){if(i.length>0)if(s.length===i.length)for(let t=0;t<s.length;t++)s[t].tlyric=i[t].text;else for(let t=0;t<s.length;t++)for(let a=0;a<i.length;a++)s[t].time===i[a].time&&(s[t].tlyric=i[a].text);if(a.length>0)if(s.length===a.length)for(let t=0;t<s.length;t++)s[t].romalrc=a[t].text;else for(let t=0;t<s.length;t++)for(let i=0;i<a.length;i++)s[t].time===a[i].time&&(s[t].romalrc=a[i].text);return s}(f(n.lrc.lyric),f(null==(i=n.tlyric)?void 0:i.lyric),f(null==(a=n.romalrc)?void 0:a.lyric))}function f(s){if(!s)return[];const i=s.split("\n").map((s=>{const i=s.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\]/),a=s.replace(/\[(\d{2}):(\d{2})\.(\d{2,3})\]/,"");if(i&&a)return 2===i[3].length&&(i[3]=10*i[3]),{time:60*i[1]+1*i[2]+i[3]/1e3,text:a}})).filter((s=>s));for(let a=0;a<i.length;a++)a===i.length-1?i[a].nextTime=i[a].time+5:i[a].nextTime=i[a+1].time;return i}return{audio:a,audioData:t,changeQuality:async function(s){t.level=s,await n(t.song.id),c(!0),console.log("🎵切换音质")},playPrevSong:async function(){if(t.songs.length>0){const s=t.songs.findIndex((s=>s.id===t.song.id));0===s?(t.song=t.songs[t.songs.length-1],await n(t.song.id),c(t.isPlay),a.currentTime=0,t.isTrial=!1):(t.song=t.songs[s-1],await n(t.song.id),c(t.isPlay),a.currentTime=0,t.isTrial=!1),console.log("⏮播放上一首")}},playNextSong:r,addAllToPlayList:async function(s){t.songs=s,t.song=s[0],await n(s[0].id),c(!0),console.log("✅歌单播放成功",t.songs)},clearPlayList:l,removeSongFromPlayList:function(s){t.songs=t.songs.filter((i=>i.id!==s)),t.song.id===s&&r(),0===t.songs.length&&l(),console.log("✅移除成功",t.songs)},changeCurrentSong:async function(s){await o(s),await n(s),e(),c(!0)},playSong:async function(s){if(t.song.id===s)return console.log("正在播放该歌曲");await o(s),await n(s),e(),c(!0)},play:c}}),{persist:!0}),q=s=>(M("data-v-d4059aa1"),s=s(),C(),s),F={class:"mvListDetail nowrap"},V={class:"mvListDetail__header"},A={class:"nowrap"},z={style:{"aspect-ratio":"16 / 9",width:"100%"}},H={class:"mvListDetail__info"},N={class:"mvListDetail__info__top"},Q={class:"mvListDetail__info__top__left"},B=["src"],G={class:"mvListDetail__info__bottom"},O={key:0},W={class:"mvListDetail__info__icon"},X={class:"mvListDetail__info__icon__item"},Z={class:"mvListDetail__info__icon__item"},$={class:"mvListDetail__info__icon__item"},E={class:"mvListDetail__info__icon__item"},J=q((()=>h("div",{class:"mvListDetail__info__line"},null,-1))),K={class:"mvListDetail__info__recommend"},Y=q((()=>h("div",{class:"mvListDetail__info__recommend__title"},"相似MV推荐",-1))),ss={class:"mvListDetail__info__recommend__list"},is=I({__name:"index",async setup(s){let i,e;const{getMvDetail:l,getMvUrl:r,mvListDetail:c,getSimiMv:m}=R(),{play:u}=k(),g=S(),d=v({width:"100%",height:"auto",color:"#f9343d",title:"",src:"",muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","fullScreen"]});async function M(){await l(g.query.id),await r(g.query.id,1080),await m(g.query.id),d.src=c.mvUrl,d.title=c.mv.name}function C(){console.log("视频播放时暂停音乐播放"),u(!1)}return[i,e]=f((()=>M())),await i,e(),p((()=>g.query.id),(s=>{"/mvListDetail"===g.path&&M()})),(s,i)=>{const e=a;return y(),_("div",F,[h("div",V,[w(e,{name:"arrow-left",size:"22",onClick:i[0]||(i[0]=i=>s.$router.back())}),h("span",A,T(D(c).mv.name),1),w(e,{name:"weapp-nav",size:"22"})]),h("div",z,[w(D(o),L(d,{onPlay:C}),null,16)]),h("div",H,[h("div",N,[h("div",Q,[h("img",{src:D(c).mv.artists[0].img1v1Url+"?param=50y50",alt:""},null,8,B),h("span",null,T(D(c).mv.artists[0].name),1)]),w(n,{id:D(c).mv.artists[0].id,followed:D(c).mv.artists[0].followed},null,8,["id","followed"])]),h("div",G,[h("span",null,T(D(c).mv.name),1),h("span",null,"发布时间："+T(D(c).mv.publishTime),1),D(c).mv.desc?(y(),_("span",O,"简介："+T(D(c).mv.desc),1)):x("",!0)]),h("div",W,[h("div",X,[w(e,{name:"play-circle-o"}),h("span",null,T(D(U)(D(c).mv.playCount)),1)]),h("div",Z,[w(e,{name:"star-o"}),h("span",null,T(D(U)(D(c).mv.subCount)),1)]),h("div",$,[w(e,{name:"chat-o"}),h("span",null,T(D(U)(D(c).mv.commentCount)),1)]),h("div",E,[w(e,{name:"share-o"}),h("span",null,T(D(U)(D(c).mv.shareCount)),1)])]),J,h("div",K,[Y,h("div",ss,[(y(!0),_(P,null,j(D(c).simiMvs,(s=>(y(),b(t,{key:s.id,config:s},null,8,["config"])))),128))])])])])}}},[["__scopeId","data-v-d4059aa1"]]);export{is as default};
