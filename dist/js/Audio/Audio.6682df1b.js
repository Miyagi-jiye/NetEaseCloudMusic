import{P as s,Q as o,S as n,_ as i,U as e,V as l,W as t,a}from"../@vue/@vue.94aa2a2d.js";import{u as r}from"../vue-router/vue-router.b68e67a8.js";import{_ as c}from"../../assets/index-bc50e15e.js";import{d as g}from"../pinia/pinia.86e899a9.js";import{a as u,s as d,b as y}from"../index/index.a7ba02c1.js";import{s as m,g as f}from"../vant/vant.52bb3d0f.js";const h=["onClick"],p=["width","height"],v=[(s=>(e("data-v-cf2f0de7"),s=s(),l(),s))((()=>t("path",{d:"M505.173333 384.426667c-32.426667-24.32-78.506667-1.706667-78.506666 38.826666v177.493334c0 40.533333 46.08 63.573333 78.506666 38.826666l116.48-88.746666c25.6-19.626667 25.6-58.453333 0-77.653334l-116.48-88.746666z m260.693334-203.093334c-168.533333-14.08-339.2-14.08-507.733334 0C135.253333 192 42.666667 288 42.666667 405.333333v213.333334c0 117.333333 92.586667 213.333333 215.466666 224 84.053333 7.253333 168.96 10.666667 253.866667 10.666666s169.813333-3.413333 253.866667-10.666666c122.88-10.666667 215.466667-106.666667 215.466666-224v-213.333334c0-117.333333-92.586667-213.333333-215.466666-224zM896 618.666667c0 72.533333-58.88 132.266667-137.386667 138.666666-163.413333 14.08-329.386667 14.08-493.226666 0C186.88 750.933333 128 691.2 128 618.666667v-213.333334c0-72.533333 58.88-132.266667 137.386667-138.666666C347.306667 259.413333 429.653333 256 512 256s164.693333 3.413333 246.613333 10.666667C837.12 273.066667 896 332.8 896 405.333333v213.333334z","p-id":"15910",fill:"currentColor"},null,-1)))],T=c({__name:"index",props:{mvid:Number,color:{type:String,default:"#b4b4b4"},size:{type:Number,default:24}},setup(e){const l=e,t=r(),a=()=>{t.push({path:"/mvListDetail",query:{id:l.mvid}})};return(l,t)=>(s(),o("div",{class:"MVIcon",onClick:i(a,["stop"]),title:"播放MV"},[(s(),o("svg",{t:"1668065190182",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"15909",width:e.size,height:e.size,style:n({color:e.color})},v,12,p))],8,h))}},[["__scopeId","data-v-cf2f0de7"]]),w=g("Audio",(()=>{const s=new Audio,o=a({url:"",level:"standard",song:{},songs:[],volume:.5,duration:0,isPlay:!1,playMode:"order",lyric:"",haveRomalrc:!1,haveTlyric:!1,isTrial:!1});async function n(s){const n=await d(s,o.level);o.url=n.data[0].url,await c(o.song.id)}async function i(s){const n=await y(s);o.song=n.songs[0]}function e(){o.songs.some((s=>s.id===o.song.id))?console.log("❌重复添加",o.songs):(o.songs.push(o.song),console.log("✅添加成功",o.songs))}function l(){o.songs=[],o.song={},o.url="",o.lyric="",s.pause(),console.log("🧺清空成功",o.songs)}async function t(){if(o.songs.length>0){const i=o.songs.findIndex((s=>s.id===o.song.id));i===o.songs.length-1?(o.song=o.songs[0],await n(o.song.id),r(o.isPlay),s.currentTime=0):(o.song=o.songs[i+1],await n(o.song.id),r(o.isPlay),s.currentTime=0),console.log("⏭播放下一首")}}async function r(i){o.isPlay=i,o.isPlay?(s.src&&s.src===o.url?s.play().then((()=>{s.duration<31?(o.isTrial=!o.isTrial,setTimeout((()=>{o.isTrial=!0}),0)):(o.isTrial=!o.isTrial,setTimeout((()=>{o.isTrial=!1}),0)),console.log("🎵audio.src存在，继续播放")})).catch((async i=>{console.log("❗歌曲链接过期",i),await n(o.song.id),s.src=o.url,s.play().then((()=>{console.log("🎵audio.src不存在，重新获取歌曲链接并播放")})).catch((n=>{console.log("❗播放失败",n),o.isPlay=!1,s.pause()}))})):o.url?(s.src=o.url,s.play().then((()=>{s.duration<31?(o.isTrial=!o.isTrial,setTimeout((()=>{o.isTrial=!0}),0)):(o.isTrial=!o.isTrial,setTimeout((()=>{o.isTrial=!1}),0))})).catch((n=>{console.log("🎵url获取成功，但是播放失败",n),o.isPlay=!1,s.pause()}))):4===o.song.fee?(o.isPlay=!1,s.pause(),m({type:"primary",message:"数字专辑歌曲请先购买后再播放"})):0===o.song.fee?(o.isPlay=!1,s.pause(),m({type:"warning",message:"暂无播放版权"})):(o.isPlay=!1,s.pause(),console.log("🎵url获取失败，播放失败"),f("VIP歌曲")),s.onended=()=>{t(),console.log("播放结束,自动播放下一首")},o.lyric||c(o.song.id),console.log("🎤播放")):(s.pause(),console.log("⏸暂停"))}async function c(s){var n,i;const e=await u(s);e.romalrc&&e.romalrc.lyric?o.haveRomalrc=!0:o.haveRomalrc=!1,e.tlyric&&e.tlyric.lyric?o.haveTlyric=!0:o.haveTlyric=!1,o.lyric=function(s,o,n){if(o.length>0)if(s.length===o.length)for(let i=0;i<s.length;i++)s[i].tlyric=o[i].text;else for(let i=0;i<s.length;i++)for(let n=0;n<o.length;n++)s[i].time===o[n].time&&(s[i].tlyric=o[n].text);if(n.length>0)if(s.length===n.length)for(let i=0;i<s.length;i++)s[i].romalrc=n[i].text;else for(let i=0;i<s.length;i++)for(let o=0;o<n.length;o++)s[i].time===n[o].time&&(s[i].romalrc=n[o].text);return s}(g(e.lrc.lyric),g(null==(n=e.tlyric)?void 0:n.lyric),g(null==(i=e.romalrc)?void 0:i.lyric))}function g(s){if(!s)return[];const o=s.split("\n").map((s=>{const o=s.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\]/),n=s.replace(/\[(\d{2}):(\d{2})\.(\d{2,3})\]/,"");if(o&&n)return 2===o[3].length&&(o[3]=10*o[3]),{time:60*o[1]+1*o[2]+o[3]/1e3,text:n}})).filter((s=>s));for(let n=0;n<o.length;n++)n===o.length-1?o[n].nextTime=o[n].time+5:o[n].nextTime=o[n+1].time;return o}return{audio:s,audioData:o,changeQuality:async function(s){o.level=s,await n(o.song.id),r(!0),console.log("🎵切换音质")},playPrevSong:async function(){if(o.songs.length>0){const i=o.songs.findIndex((s=>s.id===o.song.id));0===i?(o.song=o.songs[o.songs.length-1],await n(o.song.id),r(o.isPlay),s.currentTime=0,o.isTrial=!1):(o.song=o.songs[i-1],await n(o.song.id),r(o.isPlay),s.currentTime=0,o.isTrial=!1),console.log("⏮播放上一首")}},playNextSong:t,addAllToPlayList:async function(s){o.songs=s,o.song=s[0],await n(s[0].id),r(!0),console.log("✅歌单播放成功",o.songs)},clearPlayList:l,removeSongFromPlayList:function(s){o.songs=o.songs.filter((o=>o.id!==s)),o.song.id===s&&t(),0===o.songs.length&&l(),console.log("✅移除成功",o.songs)},changeCurrentSong:async function(s){await i(s),await n(s),e(),r(!0)},playSong:async function(s){if(o.song.id===s)return console.log("正在播放该歌曲");await i(s),await n(s),e(),r(!0)},play:r}}),{persist:!0});export{T as M,w as u};
